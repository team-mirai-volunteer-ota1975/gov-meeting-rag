<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Gov Minutes RAG Search</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    form { margin-bottom: 1em; }
    textarea { width: 100%; height: 60px; }
    pre { background: #f4f4f4; padding: 1em; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Gov Minutes RAG Search</h1>

  <form id="searchForm">
    <label>Query:<br>
      <textarea name="query" required></textarea>
    </label><br><br>
    <label>Top K:
      <input type="number" name="top_k" value="5" min="1" max="100">
    </label><br><br>
    <label>Ministry (任意):
      <input type="text" name="ministry" placeholder="厚生労働省 など">
    </label><br><br>
    <button type="submit">Search</button>
    <button type="button" onclick="runSummarySearch()">Summary Search</button>
  </form>

  <h2>Results</h2>
  <pre id="result"></pre>

  <script>
    async function postData(endpoint, data) {
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });
      if (!res.ok) {
        const err = await res.text();
        throw new Error(`Error ${res.status}: ${err}`);
      }
      return res.json();
    }

    document.getElementById("searchForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const data = {
        query: form.query.value,
        top_k: parseInt(form.top_k.value) || 5,
        ministry: form.ministry.value || null,
      };
      try {
        const result = await postData("/app/search", data);
        document.getElementById("result").textContent = JSON.stringify(result, null, 2);
      } catch (err) {
        document.getElementById("result").textContent = err;
      }
    });

    async function runSummarySearch() {
      const form = document.getElementById("searchForm");
      const data = {
        query: form.query.value,
        top_k: parseInt(form.top_k.value) || 5,
        ministry: form.ministry.value || null,
      };
      try {
        const result = await postData("/app/summary_search", data);
        document.getElementById("result").textContent = JSON.stringify(result, null, 2);
      } catch (err) {
        document.getElementById("result").textContent = err;
      }
    }
  </script>
</body>
</html>
